<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparativo de Produtos - Soja</title>
<style>
/* --- Estilos id√™nticos aos originais --- */
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
background: linear-gradient(180deg, #f5f5f7 0%, #e5e5e7 100%);
min-height: 100vh;
padding: 20px;
}
.container {
max-width: 900px;
margin: 0 auto;
}
.card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 12px;
padding: 20px;
margin-bottom: 12px;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
}
.section-title {
font-size: 0.75em;
color: #86868b;
text-transform: uppercase;
letter-spacing: 0.5px;
font-weight: 500;
margin-bottom: 16px;
}
.form-row {
display: flex;
align-items: center;
padding: 8px 0;
border-bottom: 1px solid #e5e5e7;
}
.form-row:last-child {
border-bottom: none;
}
.form-row label {
flex: 0 0 100px;
color: #1d1d1f;
font-size: 0.9em;
}
.form-row input[type="text"],
.form-row input[type="number"] {
flex: 1;
border: none;
background: transparent;
text-align: right;
font-size: 0.9em;
color: #1d1d1f;
padding: 4px 0;
}
.form-row input[type="text"]:focus,
.form-row input[type="number"]:focus {
outline: none;
}
.form-row input[type="number"] {
max-width: 120px;
}
.farm-name-container {
display: flex;
align-items: center;
gap: 12px;
flex: 1;
justify-content: flex-end;
}
.farm-name-container input[type="text"] {
flex: 1;
border: none;
background: transparent;
text-align: right;
font-size: 0.9em;
color: #1d1d1f;
padding: 4px 8px 4px 0;
}
.logo-btn {
width: 32px;
height: 32px;
background: transparent;
border: none;
border-radius: 6px;
font-size: 16px;
cursor: pointer;
transition: all 0.2s;
display: flex;
align-items: center;
justify-content: center;
padding: 0;
flex-shrink: 0;
order: 3;
}
.logo-btn:hover {
background: #f5f5f7;
}
.logo-btn.hidden {
display: none !important;
}
.logo-preview {
width: 32px;
height: 32px;
border-radius: 6px;
object-fit: cover;
display: none;
flex-shrink: 0;
order: 2;
}
.logo-preview.show {
display: block;
}
.upload-container {
display: flex;
align-items: center;
justify-content: flex-end;
gap: 8px;
}
.upload-btn-small {
width: 32px;
height: 32px;
background: transparent;
border: 1px solid #d1d1d6;
border-radius: 6px;
font-size: 16px;
cursor: pointer;
transition: all 0.2s;
display: flex;
align-items: center;
justify-content: center;
padding: 0;
}
.upload-btn-small:hover {
background: #f5f5f7;
border-color: #86868b;
}
.upload-btn-small.hidden {
display: none !important;
}
.upload-preview-small {
width: 32px;
height: 32px;
border-radius: 6px;
object-fit: cover;
display: none;
border: 1px solid #e5e5e7;
}
.upload-preview-small.show {
display: block;
}
.comparison-item {
background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(245, 245, 247, 0.98) 100%);
backdrop-filter: blur(10px);
border-radius: 12px;
padding: 20px;
margin-bottom: 16px;
box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08), 0 8px 32px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.8);
}
.comparison-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 16px;
}
.comparison-controls {
display: flex;
gap: 8px;
align-items: center;
}
.photo-layout-select {
padding: 4px 28px 4px 8px;
border: 1px solid #d1d1d6;
border-radius: 6px;
background: white;
font-size: 0.8em;
color: #86868b;
cursor: pointer;
appearance: none;
background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%2386868b' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
background-repeat: no-repeat;
background-position: right 8px center;
}
.photo-layout-select:focus {
outline: none;
border-color: #007AFF;
}
.control-btn {
width: 24px;
height: 24px;
border: none;
background: transparent;
cursor: pointer;
font-size: 20px;
line-height: 1;
display: flex;
align-items: center;
justify-content: center;
border-radius: 4px;
transition: all 0.2s;
color: #86868b;
padding: 0;
}
.control-btn:hover {
background: rgba(0, 0, 0, 0.05);
}
.close-btn {
color: #FF3B30;
}
.close-btn:hover {
background: rgba(255, 59, 48, 0.1);
}
.collapse-btn {
color: #86868b;
}
.collapse-icon {
font-weight: 300;
font-size: 24px;
}
.comparison-content {
overflow: hidden;
transition: all 0.3s ease;
}
.comparison-content.collapsed {
max-height: 0;
opacity: 0;
}
.comparison-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 16px;
margin-bottom: 16px;
}
.comparison-grid.single-photo {
grid-template-columns: 1fr;
}
.comparison-grid.single-photo .comparison-side:last-child {
display: none;
}
.comparison-grid.single-photo .comparison-side {
max-width: 100%;
}
.comparison-grid.single-photo .side-label {
display: none;
}
.comparison-side {
display: flex;
flex-direction: column;
gap: 12px;
}
.side-label {
font-size: 0.75em;
color: #86868b;
text-transform: uppercase;
letter-spacing: 0.5px;
font-weight: 500;
text-align: center;
padding: 4px 8px;
border-radius: 4px;
cursor: text;
transition: background 0.2s;
}
.side-label:hover {
background: #f5f5f7;
}
.side-label:focus {
outline: none;
background: #e5e5e7;
}
.photo-upload {
position: relative;
width: 100%;
min-height: 200px;
background: #f5f5f7;
border-radius: 12px;
overflow: hidden;
cursor: pointer;
border: 2px dashed #d1d1d6;
transition: all 0.2s;
display: flex;
align-items: center;
justify-content: center;
}
.photo-upload:hover {
border-color: #007AFF;
background: #f0f9ff;
}
.photo-upload input {
display: none;
}
.photo-placeholder {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
text-align: center;
color: #86868b;
display: block;
}
.photo-placeholder.hidden {
display: none;
}
.photo-placeholder-icon {
font-size: 2em;
margin-bottom: 8px;
}
.photo-placeholder-text {
font-size: 0.85em;
}
.photo-preview {
width: 100%;
height: auto;
object-fit: contain;
display: none;
}
.photo-preview.show {
display: block;
}
.photo-upload.has-photo {
border: none;
cursor: default;
}
/* Demais estilos (footer, roi, etc.) iguais... */
select {
width: 100%;
padding: 10px 12px;
border: 1px solid #d1d1d6;
border-radius: 8px;
background: white;
font-size: 0.9em;
color: #1d1d1f;
cursor: pointer;
appearance: none;
background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%2386868b' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
background-repeat: no-repeat;
background-position: right 12px center;
padding-right: 36px;
}
select:focus {
outline: none;
border-color: #007AFF;
box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}
textarea {
width: 100%;
padding: 10px 12px;
border: 1px solid #d1d1d6;
border-radius: 8px;
background: white;
font-size: 0.9em;
color: #1d1d1f;
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
resize: vertical;
min-height: 60px;
}
textarea:focus {
outline: none;
border-color: #007AFF;
box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}
textarea::placeholder {
color: #86868b;
}
.add-menu-container {
position: relative;
display: inline-block;
margin-top: 12px;
}
.add-comparison-btn {
background: #e5e5e7;
color: #86868b;
border: none;
padding: 10px 16px;
border-radius: 8px;
font-size: 0.9em;
font-weight: 500;
cursor: pointer;
transition: all 0.2s;
display: inline-flex;
align-items: center;
gap: 6px;
}
.add-comparison-btn:hover {
background: #d1d1d6;
color: #5e5e63;
}
.add-menu {
display: none;
position: absolute;
top: 100%;
left: 0;
margin-top: 4px;
background: white;
border-radius: 8px;
box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
overflow: hidden;
min-width: 140px;
z-index: 100;
}
.add-menu.show {
display: block;
}
.add-menu-item {
display: block;
width: 100%;
padding: 10px 16px;
border: none;
background: white;
text-align: left;
font-size: 0.9em;
color: #1d1d1f;
cursor: pointer;
transition: background 0.2s;
}
.add-menu-item:hover {
background: #f5f5f7;
}
.add-menu-item:not(:last-child) {
border-bottom: 1px solid #e5e5e7;
}
.footer {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 12px;
padding: 20px;
margin-top: 24px;
margin-bottom: 100px;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
}
.consultant-input-row {
display: flex;
align-items: center;
gap: 12px;
}
.consultant-input-row input[type="text"] {
flex: 1;
border: none;
background: transparent;
text-align: left;
font-size: 0.95em;
color: #1d1d1f;
padding: 8px 0;
border-bottom: 1px solid #e5e5e7;
}
.consultant-input-row input[type="text"]:focus {
outline: none;
border-bottom-color: #007AFF;
}
.consultant-input-row .upload-btn-small {
order: 3;
}
.consultant-input-row .upload-preview-small {
order: 2;
}
.footer-branding {
margin-top: 16px;
text-align: center;
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
}
.new-report-link {
font-size: 0.75em;
color: #007AFF;
text-decoration: none;
transition: color 0.2s;
letter-spacing: 0.3px;
}
.new-report-link:hover {
color: #0051D5;
text-decoration: underline;
}
.branding-separator {
font-size: 0.75em;
color: #d1d1d6;
}
.branding-link {
font-size: 0.75em;
color: #c7c7cc;
text-decoration: none;
transition: color 0.2s;
letter-spacing: 0.3px;
}
.branding-link:hover {
color: #86868b;
}
.conclusion-section {
margin-top: 24px;
}
.conclusion-section textarea {
width: 100%;
padding: 12px;
border: 1px solid #d1d1d6;
border-radius: 8px;
background: white;
font-size: 0.9em;
color: #1d1d1f;
resize: vertical;
min-height: 80px;
}
.conclusion-section textarea:focus {
outline: none;
border-color: #007AFF;
box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}
.roi-section {
margin-top: 20px;
}
.roi-grid {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 16px;
align-items: end;
}
.roi-input-group {
display: flex;
flex-direction: column;
gap: 6px;
}
.roi-input-group label {
font-size: 0.8em;
color: #86868b;
}
.roi-input-group input {
padding: 8px 12px;
border: 1px solid #d1d1d6;
border-radius: 8px;
background: white;
font-size: 0.9em;
color: #1d1d1f;
}
.roi-input-group input:focus {
outline: none;
border-color: #007AFF;
box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}
.roi-result {
display: flex;
flex-direction: column;
gap: 6px;
}
.roi-result label {
font-size: 0.8em;
color: #86868b;
}
.roi-value {
padding: 8px 12px;
border-radius: 8px;
background: #f5f5f7;
font-size: 1.1em;
font-weight: 600;
color: #1d1d1f;
text-align: center;
}
.roi-value.positive {
background: #e8f5e9;
color: #2e7d32;
}
.roi-value.negative {
background: #ffebee;
color: #c62828;
}
.roi-return-display {
margin-top: 16px;
}
.return-value {
padding: 12px 16px;
border-radius: 8px;
background: #f5f5f7;
font-size: 1.1em;
font-weight: 600;
color: #1d1d1f;
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
}
.return-value.positive {
background: #e8f5e9;
color: #2e7d32;
}
.return-value.negative {
background: #ffebee;
color: #c62828;
}
.return-icon {
font-size: 1.2em;
}
.return-text {
font-variant-numeric: tabular-nums;
}
.remove-btn {
background: linear-gradient(135deg, #FF3B30 0%, #D70015 100%);
color: white;
border: none;
padding: 8px 16px;
border-radius: 8px;
font-size: 0.85em;
font-weight: 500;
cursor: pointer;
box-shadow: 0 2px 8px rgba(255, 59, 48, 0.3);
transition: all 0.2s;
margin-top: 12px;
}
.remove-btn:hover {
transform: translateY(-1px);
box-shadow: 0 4px 12px rgba(255, 59, 48, 0.4);
}
.floating-btn {
position: fixed;
bottom: 30px;
right: 30px;
width: 60px;
height: 60px;
border-radius: 30px;
background: linear-gradient(135deg, #007AFF 0%, #0051D5 100%);
box-shadow: 0 4px 16px rgba(0, 122, 255, 0.4);
border: none;
color: white;
font-size: 24px;
cursor: pointer;
transition: all 0.2s;
}
.floating-btn:hover {
transform: scale(1.1);
box-shadow: 0 6px 20px rgba(0, 122, 255, 0.5);
}
@media print {
@page {
size: A4 portrait;
margin: 1.5cm 2cm;
}
* {
-webkit-print-color-adjust: exact;
print-color-adjust: exact;
}
body {
background: white;
padding: 0;
margin: 0;
}
.container {
max-width: 100%;
padding: 0;
margin: 0;
}
.floating-btn,
.add-comparison-btn,
.add-menu-container,
.control-btn,
.upload-btn-small,
.photo-layout-select,
.logo-btn {
display: none !important;
}
.comparison-content.collapsed {
max-height: none !important;
opacity: 1 !important;
}
.card {
margin-bottom: 8px;
page-break-inside: avoid;
break-inside: avoid;
}
.comparison-item {
margin-bottom: 12px;
page-break-inside: avoid !important;
break-inside: avoid !important;
}
.comparison-content,
.comparison-grid,
.comparison-side,
.conclusion-section,
.footer,
.photo-upload,
.photo-preview,
textarea {
page-break-inside: avoid !important;
break-inside: avoid !important;
}
.photo-upload,
.photo-preview {
max-height: 220px;
object-fit: contain;
}
.footer-branding {
display: flex !important;
}
.new-report-link,
.branding-link {
color: #007AFF !important;
text-decoration: underline;
}
body {
font-size: 11pt;
}
.section-title {
font-size: 9pt;
}
p, h1, h2, h3, h4, h5, h6 {
orphans: 3;
widows: 3;
}
}
@media (max-width: 768px) {
.comparison-grid {
grid-template-columns: 1fr;
}
.roi-grid {
grid-template-columns: 1fr;
}
}
</style>
</head>
<body>
<div class="container">
<!-- Informa√ß√µes Gerais -->
<div class="card">
<div class="section-title">Dados do Produtor e Talh√£o</div>
<div class="form-row">
<label>Produtor</label>
<input type="text" id="produtor" placeholder="Nome do produtor">
</div>
<div class="form-row">
<label>Cidade</label>
<input type="text" id="cidade" placeholder="Cidade - UF">
</div>
<div class="form-row">
<label>Fazenda</label>
<div class="farm-name-container">
<input type="text" id="fazenda" placeholder="Nome da fazenda">
<input type="file" id="logoUpload" accept="image/*" style="display: none;">
<img id="logoPreview" class="logo-preview" alt="Logo">
<button class="logo-btn" id="logoBtn" onclick="document.getElementById('logoUpload').click()">üì∑</button>
</div>
</div>
<div class="form-row">
<label>Talh√£o</label>
<input type="text" id="talhao" placeholder="Nome do talh√£o">
</div>
<div class="form-row">
<label>Tamanho (ha)</label>
<input type="number" id="tamanhoHa" placeholder="0.00" step="0.01" max="9999999">
</div>
</div>

<!-- Compara√ß√µes -->
<div id="comparisonsContainer"></div>

<div class="add-menu-container">
<button class="add-comparison-btn" onclick="toggleAddMenu()">
+ Adicionar
</button>
<div class="add-menu" id="addMenu">
<button class="add-menu-item" onclick="addComparison(); toggleAddMenu();">Avalia√ß√£o</button>
<button class="add-menu-item" onclick="addConclusao(); toggleAddMenu();">Conclus√£o</button>
<button class="add-menu-item" onclick="addROI(); toggleAddMenu();">ROI</button>
</div>
</div>

<!-- Footer -->
<div class="footer">
<div class="consultant-input-row">
<input type="text" id="consultorNome" placeholder="Nome do consultor">
<input type="file" id="consultorUpload" accept="image/*" style="display: none;">
<img id="consultorPreview" class="upload-preview-small" alt="Consultor">
<button class="upload-btn-small" id="consultorBtn" onclick="document.getElementById('consultorUpload').click()">üì∑</button>
</div>
<div class="footer-branding">
<a href="https://afonsoraudinei.github.io/Relat-rio-/" target="_blank" class="new-report-link">Novo relat√≥rio</a>
<span class="branding-separator">‚Ä¢</span>
<a href="https://afonsoraudinei.github.io/" target="_blank" class="branding-link">SoloForte</a>
</div>
</div>
</div>

<button class="floating-btn" onclick="window.print()" title="Exportar PDF">üñ®Ô∏è</button>

<script>
// ============== UTILS ==============
function readFileAsDataURL(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

function saveToStorage() {
  const state = {
    produtor: document.getElementById('produtor').value,
    cidade: document.getElementById('cidade').value,
    fazenda: document.getElementById('fazenda').value,
    talhao: document.getElementById('talhao').value,
    tamanhoHa: document.getElementById('tamanhoHa').value,
    logo: document.getElementById('logoPreview').src.includes('data:image') ? document.getElementById('logoPreview').src : null,
    consultorNome: document.getElementById('consultorNome').value,
    consultorFoto: document.getElementById('consultorPreview').src.includes('data:image') ? document.getElementById('consultorPreview').src : null,
    comparisons: [],
    conclusao: document.getElementById('conclusao')?.value || null,
    roi: {
      investimento: document.getElementById('investimento')?.value || null,
      retorno: document.getElementById('retorno')?.value || null
    }
  };

  // Salva cada compara√ß√£o
  document.querySelectorAll('.comparison-item').forEach(el => {
    const id = el.id.replace('comparison-', '');
    const leftPhoto = document.getElementById(`leftPreview-${id}`)?.src;
    const rightPhoto = document.getElementById(`rightPreview-${id}`)?.src;
    state.comparisons.push({
      id: parseInt(id),
      layout: document.querySelector(`#grid-${id}`).classList.contains('single-photo') ? '1' : '2',
      leftLabel: document.querySelector(`#grid-${id} .comparison-side:first-child .side-label`)?.textContent || 'Produto Padr√£o',
      rightLabel: document.querySelector(`#grid-${id} .comparison-side:last-child .side-label`)?.textContent || 'Produto Testado',
      leftPhoto: leftPhoto?.includes('data:image') ? leftPhoto : null,
      rightPhoto: rightPhoto?.includes('data:image') ? rightPhoto : null,
      leftEstadio: el.querySelector('.comparison-side:first-child select')?.value || '',
      rightEstadio: el.querySelector('.comparison-side:last-child select')?.value || '',
      leftNotes: el.querySelector('.comparison-side:first-child textarea')?.value || '',
      rightNotes: el.querySelector('.comparison-side:last-child textarea')?.value || '',
      photoHeight: el.querySelector('.photo-height-input')?.value || '200'
    });
  });

  localStorage.setItem('sojaReport', JSON.stringify(state));
}

function restoreFromStorage() {
  const saved = localStorage.getItem('sojaReport');
  if (!saved) return;

  const state = JSON.parse(saved);
  document.getElementById('produtor').value = state.produtor || '';
  document.getElementById('cidade').value = state.cidade || '';
  document.getElementById('fazenda').value = state.fazenda || '';
  document.getElementById('talhao').value = state.talhao || '';
  document.getElementById('tamanhoHa').value = state.tamanhoHa || '';

  if (state.logo) {
    document.getElementById('logoPreview').src = state.logo;
    document.getElementById('logoPreview').classList.add('show');
    document.getElementById('logoBtn').classList.add('hidden');
  }

  document.getElementById('consultorNome').value = state.consultorNome || '';
  if (state.consultorFoto) {
    document.getElementById('consultorPreview').src = state.consultorFoto;
    document.getElementById('consultorPreview').classList.add('show');
    document.getElementById('consultorBtn').classList.add('hidden');
  }

  state.comparisons.forEach(cmp => {
    addComparisonFromData(cmp);
  });

  if (state.conclusao !== null) addConclusao(state.conclusao);
  if (state.roi.investimento || state.roi.retorno) addROI(state.roi.investimento, state.roi.retorno);
}

// ============== EVENTOS DE SALVAMENTO ==============
['produtor', 'cidade', 'fazenda', 'talhao', 'tamanhoHa', 'consultorNome'].forEach(id => {
  document.getElementById(id).addEventListener('input', saveToStorage);
});

document.getElementById('logoUpload').addEventListener('change', async function(e) {
  const file = e.target.files[0];
  if (file) {
    const dataUrl = await readFileAsDataURL(file);
    document.getElementById('logoPreview').src = dataUrl;
    document.getElementById('logoPreview').classList.add('show');
    document.getElementById('logoBtn').classList.add('hidden');
    saveToStorage();
  }
});

document.getElementById('consultorUpload').addEventListener('change', async function(e) {
  const file = e.target.files[0];
  if (file) {
    const dataUrl = await readFileAsDataURL(file);
    document.getElementById('consultorPreview').src = dataUrl;
    document.getElementById('consultorPreview').classList.add('show');
    document.getElementById('consultorBtn').classList.add('hidden');
    saveToStorage();
  }
});

// ============== COMPARISON ==============
let comparisonCount = 0;

function addComparisonFromData(data) {
  comparisonCount = Math.max(comparisonCount, data.id);
  addComparisonInternal(data);
}

function addComparison() {
  comparisonCount++;
  addComparisonInternal();
}

function addComparisonInternal(data = null) {
  const container = document.getElementById('comparisonsContainer');
  const photoHeight = data?.photoHeight || '200';

  const comparisonHTML = `
  <div class="comparison-item" id="comparison-${comparisonCount}">
    <div class="comparison-header">
      <div class="section-title">Avalia√ß√£o ${comparisonCount}</div>
      <div class="comparison-controls">
        <select class="photo-layout-select" onchange="togglePhotoLayout(${comparisonCount}, this.value)">
          <option value="2" ${data?.layout === '2' ? 'selected' : ''}>2 fotos</option>
          <option value="1" ${data?.layout === '1' ? 'selected' : ''}>1 foto</option>
        </select>
        <input type="number" class="photo-height-input" value="${photoHeight}" min="100" max="500" style="width:60px; padding:2px 4px; font-size:0.8em; border:1px solid #d1d1d6; border-radius:4px;" oninput="adjustPhotoHeight(${comparisonCount}, this.value)">
        <button class="control-btn collapse-btn" onclick="toggleCollapse(${comparisonCount})" title="Expandir/Recolher">
          <span class="collapse-icon">‚àí</span>
        </button>
        <button class="control-btn close-btn" onclick="removeComparison(${comparisonCount})" title="Remover">√ó</button>
      </div>
    </div>
    <div class="comparison-content" id="content-${comparisonCount}">
      <div class="comparison-grid" id="grid-${comparisonCount}" ${data?.layout === '1' ? 'class="comparison-grid single-photo"' : ''}>
        <div class="comparison-side">
          <div class="side-label" contenteditable="true">${data?.leftLabel || 'Produto Padr√£o'}</div>
          <div class="photo-upload" id="photoUploadLeft-${comparisonCount}" onclick="document.getElementById('leftPhoto-${comparisonCount}').click()" style="min-height:${photoHeight}px">
            <input type="file" id="leftPhoto-${comparisonCount}" accept="image/*" onchange="handlePhotoUpload(event, 'leftPreview-${comparisonCount}', ${comparisonCount})">
            <div class="photo-placeholder">
              <div class="photo-placeholder-icon">üì∑</div>
              <div class="photo-placeholder-text">Adicionar Foto</div>
            </div>
            <img id="leftPreview-${comparisonCount}" class="photo-preview" alt="Foto esquerda" style="max-height:${photoHeight}px">
          </div>
          <select>
            <option value="">Est√°dio Fenol√≥gico</option>
            <option value="VE" ${data?.leftEstadio === 'VE' ? 'selected' : ''}>VE - Emerg√™ncia</option>
            <option value="VC" ${data?.leftEstadio === 'VC' ? 'selected' : ''}>VC - Cotil√©dones</option>
            <option value="V1" ${data?.leftEstadio === 'V1' ? 'selected' : ''}>V1 - Primeiro n√≥</option>
            <option value="V2" ${data?.leftEstadio === 'V2' ? 'selected' : ''}>V2 - Segundo n√≥</option>
            <option value="V3" ${data?.leftEstadio === 'V3' ? 'selected' : ''}>V3 - Terceiro n√≥</option>
            <option value="V4" ${data?.leftEstadio === 'V4' ? 'selected' : ''}>V4 - Quarto n√≥</option>
            <option value="V5" ${data?.leftEstadio === 'V5' ? 'selected' : ''}>V5 - Quinto n√≥</option>
            <option value="V6" ${data?.leftEstadio === 'V6' ? 'selected' : ''}>V6 - Sexto n√≥</option>
            <option value="R1" ${data?.leftEstadio === 'R1' ? 'selected' : ''}>R1 - Flora√ß√£o</option>
            <option value="R2" ${data?.leftEstadio === 'R2' ? 'selected' : ''}>R2 - Flora√ß√£o Plena</option>
            <option value="R3" ${data?.leftEstadio === 'R3' ? 'selected' : ''}>R3 - In√≠cio Forma√ß√£o Vagem</option>
            <option value="R4" ${data?.leftEstadio === 'R4' ? 'selected' : ''}>R4 - Vagem Formada</option>
            <option value="R5" ${data?.leftEstadio === 'R5' ? 'selected' : ''}>R5 - In√≠cio Enchimento Gr√£o</option>
            <option value="R6" ${data?.leftEstadio === 'R6' ? 'selected' : ''}>R6 - Gr√£o Cheio</option>
            <option value="R7" ${data?.leftEstadio === 'R7' ? 'selected' : ''}>R7 - In√≠cio Matura√ß√£o</option>
            <option value="R8" ${data?.leftEstadio === 'R8' ? 'selected' : ''}>R8 - Matura√ß√£o Plena</option>
          </select>
          <textarea placeholder="Anota√ß√µes da avalia√ß√£o..." rows="3">${data?.leftNotes || ''}</textarea>
        </div>
        <div class="comparison-side">
          <div class="side-label" contenteditable="true">${data?.rightLabel || 'Produto Testado'}</div>
          <div class="photo-upload" id="photoUploadRight-${comparisonCount}" onclick="document.getElementById('rightPhoto-${comparisonCount}').click()" style="min-height:${photoHeight}px">
            <input type="file" id="rightPhoto-${comparisonCount}" accept="image/*" onchange="handlePhotoUpload(event, 'rightPreview-${comparisonCount}', ${comparisonCount})">
            <div class="photo-placeholder">
              <div class="photo-placeholder-icon">üì∑</div>
              <div class="photo-placeholder-text">Adicionar Foto</div>
            </div>
            <img id="rightPreview-${comparisonCount}" class="photo-preview" alt="Foto direita" style="max-height:${photoHeight}px">
          </div>
          <select>
            <option value="">Est√°dio Fenol√≥gico</option>
            <option value="VE" ${data?.rightEstadio === 'VE' ? 'selected' : ''}>VE - Emerg√™ncia</option>
            <option value="VC" ${data?.rightEstadio === 'VC' ? 'selected' : ''}>VC - Cotil√©dones</option>
            <option value="V1" ${data?.rightEstadio === 'V1' ? 'selected' : ''}>V1 - Primeiro n√≥</option>
            <option value="V2" ${data?.rightEstadio === 'V2' ? 'selected' : ''}>V2 - Segundo n√≥</option>
            <option value="V3" ${data?.rightEstadio === 'V3' ? 'selected' : ''}>V3 - Terceiro n√≥</option>
            <option value="V4" ${data?.rightEstadio === 'V4' ? 'selected' : ''}>V4 - Quarto n√≥</option>
            <option value="V5" ${data?.rightEstadio === 'V5' ? 'selected' : ''}>V5 - Quinto n√≥</option>
            <option value="V6" ${data?.rightEstadio === 'V6' ? 'selected' : ''}>V6 - Sexto n√≥</option>
            <option value="R1" ${data?.rightEstadio === 'R1' ? 'selected' : ''}>R1 - Flora√ß√£o</option>
            <option value="R2" ${data?.rightEstadio === 'R2' ? 'selected' : ''}>R2 - Flora√ß√£o Plena</option>
            <option value="R3" ${data?.rightEstadio === 'R3' ? 'selected' : ''}>R3 - In√≠cio Forma√ß√£o Vagem</option>
            <option value="R4" ${data?.rightEstadio === 'R4' ? 'selected' : ''}>R4 - Vagem Formada</option>
            <option value="R5" ${data?.rightEstadio === 'R5' ? 'selected' : ''}>R5 - In√≠cio Enchimento Gr√£o</option>
            <option value="R6" ${data?.rightEstadio === 'R6' ? 'selected' : ''}>R6 - Gr√£o Cheio</option>
            <option value="R7" ${data?.rightEstadio === 'R7' ? 'selected' : ''}>R7 - In√≠cio Matura√ß√£o</option>
            <option value="R8" ${data?.rightEstadio === 'R8' ? 'selected' : ''}>R8 - Matura√ß√£o Plena</option>
          </select>
          <textarea placeholder="Anota√ß√µes da avalia√ß√£o..." rows="3">${data?.rightNotes || ''}</textarea>
        </div>
      </div>
    </div>
  </div>
  `;
  container.insertAdjacentHTML('beforeend', comparisonHTML);
  if (data?.leftPhoto) {
    document.getElementById(`leftPreview-${comparisonCount}`).src = data.leftPhoto;
    document.getElementById(`leftPreview-${comparisonCount}`).classList.add('show');
    document.getElementById(`photoUploadLeft-${comparisonCount}`).classList.add('has-photo');
    document.getElementById(`photoUploadLeft-${comparisonCount}`).querySelector('.photo-placeholder').classList.add('hidden');
  }
  if (data?.rightPhoto) {
    document.getElementById(`rightPreview-${comparisonCount}`).src = data.rightPhoto;
    document.getElementById(`rightPreview-${comparisonCount}`).classList.add('show');
    document.getElementById(`photoUploadRight-${comparisonCount}`).classList.add('has-photo');
    document.getElementById(`photoUploadRight-${comparisonCount}`).querySelector('.photo-placeholder').classList.add('hidden');
  }
  saveToStorage();
}

function handlePhotoUpload(event, previewId, cmpId) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const preview = document.getElementById(previewId);
      preview.src = e.target.result;
      preview.classList.add('show');
      const uploadArea = preview.closest('.photo-upload');
      uploadArea.classList.add('has-photo');
      const placeholder = uploadArea.querySelector('.photo-placeholder');
      if (placeholder) placeholder.classList.add('hidden');
      saveToStorage();
    };
    reader.readAsDataURL(file);
  }
}

function adjustPhotoHeight(cmpId, height) {
  const h = Math.max(100, Math.min(500, parseInt(height) || 200));
  const left = document.getElementById(`photoUploadLeft-${cmpId}`);
  const right = document.getElementById(`photoUploadRight-${cmpId}`);
  const leftImg = document.getElementById(`leftPreview-${cmpId}`);
  const rightImg = document.getElementById(`rightPreview-${cmpId}`);
  if (left) left.style.minHeight = h + 'px';
  if (right) right.style.minHeight = h + 'px';
  if (leftImg) leftImg.style.maxHeight = h + 'px';
  if (rightImg) rightImg.style.maxHeight = h + 'px';
  saveToStorage();
}

function removeComparison(id) {
  const element = document.getElementById(`comparison-${id}`);
  if (element) element.remove();
  saveToStorage();
}

function toggleCollapse(id) {
  const content = document.getElementById(`content-${id}`);
  const btn = event.target.closest('.collapse-btn');
  const icon = btn.querySelector('.collapse-icon');
  if (content.classList.contains('collapsed')) {
    content.classList.remove('collapsed');
    icon.textContent = '‚àí';
  } else {
    content.classList.add('collapsed');
    icon.textContent = '+';
  }
}

function togglePhotoLayout(id, layout) {
  const grid = document.getElementById(`grid-${id}`);
  if (layout === '1') {
    grid.classList.add('single-photo');
  } else {
    grid.classList.remove('single-photo');
  }
  saveToStorage();
}

// ============== CONCLUS√ÉO ==============
function addConclusao(text = '') {
  if (document.getElementById('conclusao-section')) return;
  const container = document.getElementById('comparisonsContainer');
  container.insertAdjacentHTML('beforeend', `
    <div class="card conclusion-section" id="conclusao-section">
      <div class="comparison-header">
        <div class="section-title">Conclus√£o</div>
        <button class="control-btn close-btn" onclick="removeConclusao()" title="Remover">√ó</button>
      </div>
      <textarea id="conclusao" placeholder="Descreva a conclus√£o da avalia√ß√£o..." rows="4">${text}</textarea>
    </div>
  `);
  document.getElementById('conclusao').addEventListener('input', saveToStorage);
}

function removeConclusao() {
  const el = document.getElementById('conclusao-section');
  if (el) el.remove();
  saveToStorage();
}

// ============== ROI ==============
function addROI(invest = '', retorno = '') {
  if (document.getElementById('roi-section')) return;
  const container = document.getElementById('comparisonsContainer');
  container.insertAdjacentHTML('beforeend', `
    <div class="card conclusion-section" id="roi-section">
      <div class="comparison-header">
        <div class="section-title">ROI</div>
        <button class="control-btn close-btn" onclick="removeROI()" title="Remover">√ó</button>
      </div>
      <div class="roi-grid">
        <div class="roi-input-group">
          <label>Investimento (R$/ha)</label>
          <input type="number" id="investimento" placeholder="0.00" step="0.01" value="${invest}" oninput="calcularROI()">
        </div>
        <div class="roi-input-group">
          <label>Retorno (R$/ha)</label>
          <input type="number" id="retorno" placeholder="0.00" step="0.01" value="${retorno}" oninput="calcularROI()">
        </div>
        <div class="roi-result">
          <label>ROI</label>
          <div class="roi-value" id="roiValue">0%</div>
        </div>
      </div>
      <div class="roi-return-display">
        <div class="return-value" id="returnValue">
          <span class="return-icon">üí∞</span>
          <span class="return-text">R$ 0,00</span>
        </div>
      </div>
    </div>
  `);
  document.getElementById('investimento').addEventListener('input', saveToStorage);
  document.getElementById('retorno').addEventListener('input', saveToStorage);
  calcularROI();
}

function removeROI() {
  const el = document.getElementById('roi-section');
  if (el) el.remove();
  saveToStorage();
}

function calcularROI() {
  const investimento = parseFloat(document.getElementById('investimento')?.value) || 0;
  const retorno = parseFloat(document.getElementById('retorno')?.value) || 0;
  const roiValueEl = document.getElementById('roiValue');
  const returnValueEl = document.getElementById('returnValue');

  let area = parseFloat(document.getElementById('tamanhoHa').value) || 0;

  const ganhoPorHa = retorno - investimento;
  const ganhoTotal = ganhoPorHa * area;

  const returnText = returnValueEl.querySelector('.return-text');
  if (area > 0) {
    returnText.textContent = 'R$ ' + ganhoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
  } else {
    returnText.textContent = 'R$ ' + ganhoPorHa.toFixed(2).replace('.', ',') + '/ha';
  }

  const ganhoParaComparar = area > 0 ? ganhoTotal : ganhoPorHa;
  returnValueEl.className = ganhoParaComparar > 0 ? 'return-value positive' : ganhoParaComparar < 0 ? 'return-value negative' : 'return-value';

  if (investimento === 0) {
    roiValueEl.textContent = '0%';
    roiValueEl.className = 'roi-value';
    return;
  }

  const roi = ((retorno - investimento) / investimento) * 100;
  roiValueEl.textContent = roi.toFixed(1) + '%';
  roiValueEl.className = roi > 0 ? 'roi-value positive' : roi < 0 ? 'roi-value negative' : 'roi-value';
}

// ============== MENU ==============
function toggleAddMenu() {
  document.getElementById('addMenu').classList.toggle('show');
}

document.addEventListener('click', function(event) {
  const container = document.querySelector('.add-menu-container');
  const menu = document.getElementById('addMenu');
  if (!container.contains(event.target)) menu.classList.remove('show');
});

// ============== INIT ==============
window.addEventListener('load', () => {
  restoreFromStorage();
  // Garante que o evento de input salve automaticamente
  document.querySelectorAll('textarea, input[type="number"], input[type="text"], select').forEach(el => {
    el.addEventListener('input', saveToStorage);
  });
});
</script>
</body>
</html>

